<template name="groupCampSearch"><div class = "container">
     {{setUp}}

     <div class="page-header">
          <h1 class="text-center">
               <img src="https://lightcastletech.files.wordpress.com/2013/04/campfire.png" width="80">
               <strong>Group Camp</strong>
               <small>Find Your Trip</small>
          </h1>
     </div>

     <form class="form-inline">
          <div class="input-group">
               <div class="input-group-addon"><span class="glyphicon glyphicon-{{getSearchGlyph}}" aria-hidden="true"></span></div>
               <input type="text" class="js-searchField form-control" size=25>
               <span class="input-group-btn">

                    <div class="js-searchGroup btn-group">
                         <input class="js-search btn btn-{{getSearchColor}}" type="submit" value="{{getSearchText}}">
                         <button type="button" class="btn btn-{{getSearchColor}} dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                              <span class="caret"></span>
                              <span class="sr-only">Toggle Dropdown</span>
                         </button>
                         <ul class="js-searchDropdown dropdown-menu">
                              <li class="js-searchByTagOption"><a href="#">Search by Tag</a></li>
                              <li class="js-searchByAuthorOption"><a href="#">Search by Author</a></li>
                              <li class="js-searchByIDOption"><a href="#">Search by ID</a></li>
                              <li role="separator" class="divider"></li>
                              <li class="js-seeAll"><a href="#">See All Available Trips</a></li>
                              <li class="js-seeMine"><a href="#">See Trips I'm Heading</a></li>
                              <li class="js-seeAmGoing"><a href="#">See Trips I'm Going On</a></li>
                              <li role="separator" class="divider"></li>
                              <li onclick="event.preventDefault(); Router.go('groupCampPost')"><a href="#">Design a New Trip</a></li>
                         </ul>
                    </div>
               </span>
          </div>
     </form>

     <br>

     {{#if hasTrips}}
          {{#each trip in getTrips}}
                    {{> GroupCampListing trip = trip}}
          {{/each}}
     {{else}}
          <p class="text-center">
               <h2><small>
                    No Trips Found
               </small></h2>
          </p>
     {{/if}}

</div></template>




<template name="GroupCampListing">
     <div class="alert alert-{{getColor}}" role="alert">
          <div class="row">
               <div class="col-md-6">
                    <a class="alert-link" data-toggle="modal" data-target="#details-{{trip._id}}">
                         <h1><strong>{{trip.title}}</strong></h1>
                    </a>

                    <em>{{trip.message}}</em>

                    <h6>
                         {{#each tag in trip.tags}}
                              <span class="label label-{{getColor}}">{{tag}}</span>
                         {{/each}}
                    </h6>

               </div>

               <div class="col-md-3">
                    {{#if trip.picture}}
                         <img src={{trip.picture}} class="img-thumbnail">
                    {{else}}
                         <img src="https://d13yacurqjgara.cloudfront.net/users/515677/screenshots/1911741/onb_icon_campfire_df.jpg" class="img-thumbnail">
                    {{/if}}
               </div>

               <div class="col-md-3">

                    {{#if isMine}}
                         <button class = "btn-sm btn-danger btn-block" data-toggle="modal" data-target="#deleteWarningModal-{{trip._id}}">Cancel Trip!</button>
                    {{else}}
                         {{#if isOpen}}
                              {{#if amGoing}}
                                   <button class = "js-changeAmGoing amGoing-color-{{trip._id}} btn-sm btn-default btn-block">
                                        <span class="amGoing-text-{{trip._id}}">Remove Me!</span>
                                   </button>
                              {{else}}
                                   <button class = "js-changeAmGoing amGoing-color-{{trip._id}} btn-sm btn-{{getColor}} btn-block">
                                        <span class="amGoing-text-{{trip._id}}">Add Me!</span>
                                   </button>
                              {{/if}}
                         {{/if}}
                    {{/if}}

                    <small>
                         {{#if trip.destination}}
                              In <em>{{trip.destination}}</em>
                         {{/if}}

                         {{#if trip.from}}
                              from <em>{{getFrom}}</em>
                         {{/if}}


                         {{#if trip.to}}
                              to <em>{{getTo}}</em>
                         {{/if}}

                         {{#if trip.cost}}
                              for <em>${{trip.cost}}</em>
                         {{/if}}

                         {{#if trip.author}}
                              by
                              {{#if isMine}}
                                   <span class="text-primary">Me</span>.
                              {{else}}
                                   <span class="text-info">{{trip.author}}</span>.
                              {{/if}}
                         {{/if}}
                         <br><br>

                         {{#if getUsername}}
                         {{else}}
                              <br>
                         {{/if}}

                         {{#if isOpen}}
                         {{else}}
                              <br>
                         {{/if}}

                         {{#if isOpen}}
                              {{#if hasEnoughTravelers}}
                                   <p class="text-right">
                                        <small>
                                             <span class="glyphicon glyphicon-ok" aria-hidden="true"></span>
                                             &nbsp;&nbsp;
                                        </small>
                                   </p>

                                   <div class="progress">
                                        <div class="progress-bar progress-bar-success progress-bar-striped" role="progressbar" style="width: 100%">
                                             This trip has enough people!
                                        </div>
                                   </div>
                              {{else}}
                                   <p class="text-right">
                                        <small>
                                             {{getTravelersNeeded trip}}

                                             {{#if isPlural}}
                                                  Travelers
                                             {{else}}
                                                  Traveler
                                             {{/if}}

                                              Needed
                                             &nbsp;
                                        </small>
                                   </p>

                                   <div class="progress">
                                        <div class="progress-bar progress-bar-warning progress-bar-striped" role="progressbar" style="width: {{getProgressBarWidth}}%"></div>
                                   </div>
                              {{/if}}
                         {{else}}
                              <br><br>
                              {{#if hasEnoughTravelers}}
                                   <p class="text-right">
                                        <small>
                                             <span class="glyphicon glyphicon-ok" aria-hidden="true"></span>
                                             &nbsp;&nbsp;
                                        </small>
                                   </p>
                              {{else}}
                                   <p class="text-right">
                                        <small>
                                             CANCELED
                                             &nbsp;&nbsp;
                                        </small>
                                   </p>
                              {{/if}}
                         {{/if}}

                    </small>

               </div>
          </div>
     </div>

     <!-- MODAL: Warning -->
	<div id="deleteWarningModal-{{trip._id}}" class="modal fade" role="dialog">
		<div class="modal-dialog modal-sm">

			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal">&times;</button>
					<h4 class="modal-title">
						<small>
							<span class="glyphicon glyphicon-tent" aria-hidden="true"></span>
							Group Camp
						</small>
					</h4>
					<h3 class="modal-title text-center">
						Warning!
					</h3>
				</div>
				<div class="modal-body">
					You are about to irreversably cancel one of your trips (<em>{{trip.title}}</em>). Are you sure you want to proceed?
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-default" data-dismiss="modal">Never Mind</button>
					<button type="button" class="btn btn-danger js-modalCancel">Cancel Trip!</button>
				</div>
			</div>

		</div>
	</div>


     <!-- MODAL: Details About Trip -->
     <div id="details-{{trip._id}}" class="modal fade" role="dialog">
          <div class="modal-dialog modal-lg">
               <div class="modal-content">

                    <div class="modal-header">
                         <button type="button" class="close" data-dismiss="modal">&times;</button>
                         <p class = "text-center">
                              <h2>
                                   <strong>{{trip.title}}</strong> <br>
                                   <small>{{trip.message}}</small>
                              </h2>
                              <h5>
                                   {{#each tag in trip.tags}}
                                        <span class="label label-default">{{tag}}</span>
                                   {{/each}}
                              </h5>
                              <h6><small>ID: <em>{{trip._id}}</em></small></h6>
                         </p>
                    </div>

                    <div class="modal-body">
                         {{#if trip.picture}}
                              <p class="text-center">
                                   <img src={{trip.picture}} width = 750>
                                   <br><br><br>
                              </p>
                         {{/if}}

                         {{#if trip.description}}
                              <blockquote>
                                   {{trip.description}}
                              </blockquote>
                         {{/if}}

                         In <em>{{trip.destination}}</em>
                         from <em>{{getFrom}}</em>
                         to <em>{{getTo}}</em>.

                         {{#if isOpen}}
                              Closes <em>{{getDeadline}}</em>.
                         {{else}}
                              Closed <em>{{getDeadline}}</em>.
                         {{/if}}

                         Created by
                         {{#if isMine}}
                              <span class="text-primary">Me</span>
                         {{else}}
                              <span class="text-info">{{trip.author}}</span>
                         {{/if}}

                         on <em>{{getTimestamp}}</em>.

                         <br><br>
                         At least {{trip.threshold}} people needed for this trip.

                         Travelers Signed Up ({{trip.travelers.length}} so far):<br>
                         <h6>
                              {{#each traveler in trip.travelers}}
                                   {{#if isMe traveler}}
                                        <span class="text-primary">Me</span>
                                   {{else}}
                                        <span class="text-info">{{traveler}}</span>
                                   {{/if}}
                                   &nbsp;
                              {{/each}}
                         </h6>

                         <br><br>

                         {{#if trip.link}}
                              <p class = "text-right">
                                   <a href={{trip.link}}>Click Here</a> for more information.
                              </p>
                              <br><br>
                         {{/if}}

                         {{#if amGoing}}
                              <hr>

                              <p class="text-right"><h6><small>{{trip.timestamp.toDateString}} at {{getTimeof trip.timestamp}}</small></h6></p>
                              <div class="alert alert-warning alert">
                                   {{#if isMine}}
                                        <span class="label label-primary">You</span>
                                   {{else}}
                                        <span class="label label-info">{{trip.author}}</span>
                                   {{/if}}
                                   created the group.
                              </div>

                              {{#each message in trip.chat}}
                                   {{#if message.alert}}
                                        <p class="text-right"><h6><small>{{message.timestamp.toDateString}} at {{getTimeof message.timestamp}}</small></h6></p>
                                        {{#if message.isGoing}}
                                             <div class="alert alert-success alert">
                                                  {{#if isMe message.username}}
                                                       <span class="label label-primary">You</span>
                                                  {{else}}
                                                       <span class="label label-info">{{message.username}}</span>
                                                  {{/if}}
                                                  joined the group.
                                             </div>
                                        {{else}}
                                             <div class="alert alert-danger">
                                                  {{#if isMe message.username}}
                                                       <span class="label label-primary">You</span>
                                                  {{else}}
                                                       <span class="label label-info">{{message.username}}</span>
                                                  {{/if}}
                                                  left the group.
                                             </div>
                                        {{/if}}
                                   {{else}}
                                        <p class="text-right">
                                             <h6>
                                                  {{#if isMe message.username}}
                                                       <span class="label label-primary">Me</span>
                                                  {{else}}
                                                       <span class="label label-info">{{message.username}}</span>
                                                  {{/if}}
                                                  <small>on {{message.timestamp.toDateString}} at {{getTimeof message.timestamp}}</small>
                                             </h6>
                                        </p>

                                        <div class="well well-sm">
                                             {{message.text}}
                                        </div>
                                   {{/if}}
                              {{/each}}
                              <br>

                              <form class="form">
                                   <div class="input-group">
                                        <div class="input-group-addon"><span class="glyphicon glyphicon-comment" aria-hidden="true"></span></div>
                                        <input type="text" class="js-postToChatText form-control">
                                        <span class="input-group-btn">
                                             <input class="js-postToChat btn btn-info" type="submit" value="Post">
                                        </span>
                                   </div>
                              </form>
                         {{/if}}
                    </div>
               </div>
          </div>
     </div>

</template>
